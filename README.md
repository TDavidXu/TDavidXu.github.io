# 徐大伟(davidxu)! AMS PTP效能中心前总监 昏庸无能 无管理能力也无技术特长 
**兵🐻一个，将🐻🐻一窝，现在AMS PTP为啥有这么多问题，就是Davidxu当年挖下的坑啊！详述某一线互联网大厂总监Davidxu的两大罪状（只是冰山一角，没时间写太多，先挑俩典型写）**
# ToC思维做ToB，Davidxu妙计安天下，降低效能他最强

##  开发联调环境没管好，无备份，数据库节点丢失，几百人工作被阻塞；重建数据库时竟然无端引入不一致风险却不带来任何好处, 2019年5月起的各种开发环境的DI行为与线上不一致问题很可能就是Davidxu挖的坑

徐大伟2018年底起担任效能中心总监岗位，至事发时(2019年4月底)有近**半年**时间,这半年时间里**数百名**工程师**共用的**开发**联调**环境的**数据库节点**一直处于**无人管理**状态。  
徐大伟担任效能中心总监近半年都未能识别这一严重拖累效能的风险点，2019年4月底，该数据库节点**硬盘物理损坏**，无法修复也无法恢复数据,也**无备份**数据，无法恢复环境，造成**数百人工作被阻塞**，徐大伟这个效能总监可真能提升效能啊，让**几百号人闲着**真有效能。   
  
如果只是这样一个工作疏忽也就罢了，毕竟人非圣贤熟能无过，咱们不能拿放大镜看别人的缺点啊。

可是徐大伟解决这个问题的方法实在让人大跌眼镜，不按照尽可能接近线上的方式恢复数据库库表结构和基础数据，此人无视线上数据库是**多库多表的物理机MySQL**,无脑强推用**单库单表的Docker MySQL**来恢复，此时有人提出**警告**说AMS PTP用的数据库中间件 虽然有一定的屏蔽源数据库多库多表的能力，对源数据库是单库单表的情形和多库多表的情形会有**处理不一致**的情况，如果用单库单表重建，将会导致**联调开发环境与线上不一致**给未来的开发工作带来**效率障碍和质量风险**，徐大伟**无视警告一意孤行，坚持强推。这就是在给全部门挖坑！**。  
![开发联调环境的普文二](/dev_db_down.png)   

|  时间   | DB分库分表 |  DB节点   | 优缺点  |
|  ----  | ----  | ----           | ---- |
| 重建前 | 多库多表 | 物理机Tlinux  |        |
| 重建后 | 单库单表 | Docker       |  引入不一致风险，却未带来Docker动态生成环境的优点 |

**2019年5月起的各种开发环境的DI行为不一致问题很可能就是Davidxu挖的坑所造成的！**  
**开发、测试的联调环境应当尽可能与线上一致，除非不一致能带来明显好处，这是基本的软件工程常识，工作一年的应届生都懂，徐大总监为啥不懂？**

对其动机的猜测： 徐大伟为了盲目追求个人KPI，想给他力推一个基于Docker的测试环境管理系统(LEGO系统)（是他调来之前已经搞起来的）找个使用场景，而开发联调环境的数据库节点丢失的事故成了他的机会，他为了**追求个人KPI无视公司利益，无视客观规律**，不惜在开发联调环境**引入不一致风险**（并且这样的用法相比于过去多库多表的物理机节点**不带来任何效能、质量上的好处**）。
那么为什么徐大伟不搞一个基于LEGO Docker的多库多表的数据库节点来重建环境呢，这样引入的不一致风险就小得多，又能实现个人KPI又不那么严重的违背公司利益了？ 因为他能力不行啊，他手下的测试开发工程师最初开发LEGO时，做成了单库单表，单并不意味着Docker里的DB只能是单库单表的啊，**执行一下多库多表的DDL不就成了多库多表的Docker DB了吗？ 为啥不这么做呢？** 因为他**没有能力稳定团队**，到4月底时开发LEGO的元老们普遍去意已决，有连系活水转部门的，有准备辞职的，总之到了下半年，LEGO团队剩下的司龄最长的人是司龄一年多的，**老骨干快跑光了**。手下青黄不接，他自己没常识不懂技术，所以**他不知道其实可以用基于LEGO Docker的多库多表数据库节点来重建环境**

##  库表结构变更流程瞎指挥，导致测试环境库表常与线上不一致，过了几周才能发现，严重耽搁开发/测试效率
### 背景：2019年时AMS PTP采用XML格式定义和管理数据库表结构，通过修改XML文件后由基础平台组用脚本产生MySQL DDL语句进行库表结构变更。
XML文件格式是《基础平台组》（开发组）所定义的，根据XML文件变更生成DDL的脚本也是《基础平台组》开发的，线上的DDL变更由《基础平台组》负责执行脚本生成DDL语句后由该组梦玲同学人工审阅和人工修改后将其确认可用的DDL发给运维执行。若执行脚本时报错，未能生成完整DDL语句，也由梦玲负责调试脚本排查解决问题。
#### 2019年业务开发人员发起库表结构修改到库表结构修改DDL语句线上执行的流程图
![业务开发人员发起库表结构修改到库表结构修改DDL语句线上执行的流程图](/sequence.png)   
#### 可以看出，原有流程虽然完美的解决了多业务开发团队共用数据库的库表变更难题，但只囊括线上环境变更忽视了测试环境的库表变更。
#### 徐大伟接任时LEGO系统中已有一套试验性的自动测试XML变更对应的DDL以及自动部署的原型系统，可以在部分情况下自动把库表变更DDL部署到测试环境，部分业务开发人员提出了要求该系统能自动地完整地部署全部库表变更到测试环境的需求。
##### 该提系统在严重的设计缺陷：
###### 1、数据处理经由多门(徐大伟整个任期不去解决这个问题，下一任总监一上任就解决)
**一套系统的开发、测试、线上环境的数据库表变更DDL应出自一个团队，这是基本的软件工程常识，应届生都懂，徐大伟不懂**。数据处理经由多门的解决办法只有合并为一个团队处理。
要么让基础平台组把测试环境一并管起来，要么让基础平台组不要管，让测试环境管理人员（团队）来做这件事，没有其他的解决办法。**数据处理经由多门的结果一定是数据不一致。**
**然而在徐大伟整个任期内，不去从根本上解决这个问题，他一被调走，下一任总监就解决了这个问题**
###### 2、该系统对测试环境库表结构变更周期与线上库表结构变更周期不一致。
测试环境在**每次修改XML文件时立即执行生成DDL和部署测试环境**，而线上**只有每周两次周例行变更时生成DDL和执行变更**
![测试环境与线上变更DDL周期不一致的问题](/DDL.png)  
###### 徐大伟无视该系统设计缺陷，无视维护人员和组长的停止该系统运行的建议，也无视维护人员人力不足（只有一人还要负担其他测试任务）盲目强制该系统维护人员做到及时准确部署。
#### 徐大伟无视软件工程基本规律，不听下属组长和工程师的建议，盲目推行有缺陷的系统，造成大量的测试联调环境与线上库表结构不一致，且这种不一致往往难以被及时发现，往往持续一两个月才被发现，给开发、测试工作带来巨大困扰，严重阻挠研发效能。
**2019年的测试联调环境与线上库表结构不一致问题，就是徐大伟的英明决策所致**



